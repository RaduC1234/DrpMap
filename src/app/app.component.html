<!-- Fixed HTML template to match the original working design -->
<div class="container">
    <!-- Header with blue gradient -->
    <div class="header">
        <button class="theme-toggle" (click)="toggleTheme()" [attr.aria-label]="isDarkTheme ? 'Switch to light theme' : 'Switch to dark theme'">
            <span class="theme-icon">{{ isDarkTheme ? 'â˜€ï¸' : 'ğŸŒ™' }}</span>
        </button>
        <h1>ğŸ—ºï¸ {{ title }}</h1>
        <p>Test your knowledge with our interactive quiz</p>
    </div>

    <!-- Start Screen -->
    <div class="start-screen" *ngIf="quizState.currentView === 'start'">
        <div class="start-content">
            <div class="start-icon">ğŸš€</div>
            <h2>Welcome to the Quiz App</h2>
            <p>Test your knowledge with randomized questions!</p>
            <button class="btn btn-start" (click)="startQuiz()">ğŸš€ Start Quiz</button>
        </div>
    </div>

    <!-- Loading Screen -->
    <div class="loading" *ngIf="quizState.currentView === 'loading'">
        <div class="spinner"></div>
        <p>Loading questions...</p>
    </div>

    <!-- Quiz Screen -->
    <div class="quiz-container" *ngIf="quizState.currentView === 'quiz'">
        <!-- Quiz Header -->
        <div class="quiz-header">
            <div class="question-counter">
                Question {{quizState.questionsAnswered + 1}} of 37
                <small>({{quizState.allQuestions.length}} total available)</small>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="getProgress()"></div>
            </div>
            <div class="score-display">
                Score: {{quizState.score}}/{{quizState.questionsAnswered}}
            </div>
        </div>

        <!-- Question Card -->
        <div class="question-card" *ngIf="quizState.currentQuestion">
            <div class="question-text">
                <ng-container *ngFor="let part of formatQuestionText(getCurrentQuestion().question)">
                    <div *ngIf="part.type === 'text'" [innerHTML]="part.content" class="text-content"></div>
                    <div *ngIf="part.type === 'code'" class="code-block">
                        <div class="code-header">{{ part.language?.toUpperCase() || 'CODE' }}</div>
                        <pre><code [highlight]="part.content" [language]="part.language || 'csharp'"></code></pre>
                    </div>
                </ng-container>
            </div>

            <!-- Answers -->
            <div class="answers">
                <div class="answer-option"
                     *ngFor="let answer of getAnswerEntries()"
                     [class.selected]="isAnswerSelected(answer.key)"
                     [class.correct]="quizState.hasAnswered && isCorrectAnswer(answer.key)"
                     [class.incorrect]="quizState.hasAnswered && isAnswerSelected(answer.key) && !isCorrectAnswer(answer.key)"
                     [class.disabled]="quizState.hasAnswered"
                     (click)="toggleAnswer(answer.key)">

                    <input type="checkbox"
                           class="answer-checkbox"
                           [checked]="isAnswerSelected(answer.key)"
                           [disabled]="quizState.hasAnswered">

                    <div class="answer-text" [innerHTML]="formatAnswerText(answer.key, answer.value)"></div>
                </div>
            </div>

            <!-- Result Panel -->
            <div class="result-panel"
                 *ngIf="quizState.hasAnswered"
                 [class.correct]="quizState.lastAnswerCorrect"
                 [class.incorrect]="!quizState.lastAnswerCorrect">
                <strong>{{quizState.lastAnswerCorrect ? 'âœ… Correct!' : 'âŒ Incorrect'}}</strong>
                <div *ngIf="!quizState.lastAnswerCorrect">
                    Correct answer(s): {{getCorrectAnswersText()}}
                </div>
                <div *ngIf="quizState.lastAnswerCorrect">Well done!</div>
            </div>

            <!-- Controls -->
            <div class="controls">
                <button class="btn btn-secondary"
                        (click)="skipQuestion()"
                        [disabled]="quizState.hasAnswered && quizState.questionsAnswered >= 37">
                    â­ï¸ Skip Question
                </button>

                <button class="btn btn-success"
                        *ngIf="!quizState.hasAnswered"
                        (click)="submitAnswer()"
                        [disabled]="quizState.selectedAnswers.length === 0">
                    âœ… Submit Answer
                </button>

                <button class="btn btn-primary"
                        *ngIf="quizState.hasAnswered"
                        (click)="nextQuestion()">
                    {{quizState.questionsAnswered >= 37 ? 'ğŸ Finish Quiz' : 'â¡ï¸ Next Question'}}
                </button>
            </div>
        </div>
    </div>

    <!-- Results Screen -->
    <div class="final-results" *ngIf="quizState.currentView === 'results'">
        <h2>ğŸ‰ Quiz Completed!</h2>
        <div class="score-circle" [ngStyle]="getScoreCircleStyle()">
            <span class="score-percentage">{{getScorePercentage()}}%</span>
        </div>
        <h3>You scored {{quizState.score}} out of {{quizState.questionsAnswered}}</h3>
        <p class="performance-text">{{getPerformanceText()}}</p>

        <div class="stats">
            ğŸ“Š Questions answered: {{quizState.questionsAnswered}} out of 37<br>
            ğŸ“š Questions available in database: {{quizState.allQuestions.length}}<br>
            ğŸ¯ Accuracy: {{getScorePercentage()}}%
        </div>

        <button class="btn btn-start" (click)="restartQuiz()">
            ğŸ”„ Take Another Quiz
        </button>
    </div>
</div>